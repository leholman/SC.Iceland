EUK.P19.pro.richness <- colSums(make_binary(EUK.P19.avr.pro.filt*1000000000000,2))
#GC1
EUK.GC1.avr.pro.filt <- EUK.GC1.avr.pro
#EUK.GC1.avr.filt[EUK.GC1.nREPS < 2] <- 0
EUK.GC1.pro.richness <- colSums(make_binary(EUK.GC1.avr.pro.filt*1000000000000,2))
### plot
year1 <- 1950-ages$mean[match(names(EUK.P19.pro.richness),ages$ID2)]
value1 <- EUK.P19.pro.richness
year2 <- 1950-ages$mean[match(names(EUK.GC1.pro.richness),ages$ID2)]
value2 <- EUK.GC1.pro.richness
gam1 <- gam(value1 ~ s(year1,k=20), method = "REML")
gam2 <- gam(value2 ~ s(year2,k=20), method = "REML")
plot(gam1)
plot(gam2)
prediction <- data.frame("year1"=-1103:1725)
prediction <- cbind(prediction,predict(gam1,newdata = prediction,se.fit = TRUE))
prediction$uppCI <- prediction$fit+prediction$se.fit*1.96
prediction$lwrCI <- prediction$fit-prediction$se.fit*1.96
prediction2 <- data.frame("year2"=-1561:1668)
prediction2 <- cbind(prediction2,predict(gam2,newdata = prediction2,se.fit = TRUE))
prediction2$uppCI <- prediction2$fit+prediction2$se.fit*1.96
prediction2$lwrCI <- prediction2$fit-prediction2$se.fit*1.96
pdf("figures/EUK.pro.richness.pdf",height=4,width=10)
par(mar=c(4.1,4.1,2.1,6.1))
plot(1950-ages$mean[match(names(EUK.P19.pro.richness),ages$ID2)],
EUK.P19.pro.richness,
xlim=c(-1550,2000),bty = 'n',ylab="ASV richness",xlab="Year",
pch=16,col="slateblue")
points(1950-ages$mean[match(names(EUK.GC1.pro.richness),ages$ID2)],
EUK.GC1.pro.richness,
pch=16,col="lightblue4")
polygon(c(prediction$year, rev(prediction$year)), c(prediction$uppCI, rev(prediction$lwrCI)), col=add.alpha('mediumslateblue',0.3), border=NA)
points(prediction$year,prediction$fit,type="l",col="navyblue",lwd=3)
polygon(c(prediction2$year, rev(prediction2$year)), c(prediction2$uppCI, rev(prediction2$lwrCI)), col=add.alpha('lightblue4',0.3), border=NA)
points(prediction2$year,prediction2$fit,type="l",col="cadetblue4",lwd=3)
dev.off()
#bacteria
#PC19
EUK.P19.avr.bac.filt <- EUK.p19.avr.bac
#EUK.P19.avr.filt[EUK.P19.nREPS < 2] <- 0
EUK.P19.bac.richness <- colSums(make_binary(EUK.P19.avr.bac.filt*1000000000000,2))
#GC1
EUK.GC1.avr.bac.filt <- EUK.GC1.avr.bac
#EUK.GC1.avr.filt[EUK.GC1.nREPS < 2] <- 0
EUK.GC1.bac.richness <- colSums(make_binary(EUK.GC1.avr.bac.filt*1000000000000,2))
### plot
year1 <- 1950-ages$mean[match(names(EUK.P19.bac.richness),ages$ID2)]
value1 <- EUK.P19.bac.richness
year2 <- 1950-ages$mean[match(names(EUK.GC1.bac.richness),ages$ID2)]
value2 <- EUK.GC1.bac.richness
gam1 <- gam(value1 ~ s(year1,k=20), method = "REML")
gam2 <- gam(value2 ~ s(year2,k=20), method = "REML")
plot(gam1)
plot(gam2)
prediction <- data.frame("year1"=-1103:1725)
prediction <- cbind(prediction,predict(gam1,newdata = prediction,se.fit = TRUE))
prediction$uppCI <- prediction$fit+prediction$se.fit*1.96
prediction$lwrCI <- prediction$fit-prediction$se.fit*1.96
prediction2 <- data.frame("year2"=-1561:1668)
prediction2 <- cbind(prediction2,predict(gam2,newdata = prediction2,se.fit = TRUE))
prediction2$uppCI <- prediction2$fit+prediction2$se.fit*1.96
prediction2$lwrCI <- prediction2$fit-prediction2$se.fit*1.96
pdf("figures/EUK.bac.richness.pdf",height=4,width=10)
par(mar=c(4.1,4.1,2.1,6.1))
plot(1950-ages$mean[match(names(EUK.P19.bac.richness),ages$ID2)],
EUK.P19.bac.richness,
xlim=c(-1550,2000),bty = 'n',ylab="ASV richness",xlab="Year",
pch=16,col="slateblue",ylim=c(50,500))
points(1950-ages$mean[match(names(EUK.GC1.bac.richness),ages$ID2)],
EUK.GC1.bac.richness,
pch=16,col="lightblue4")
polygon(c(prediction$year, rev(prediction$year)), c(prediction$uppCI, rev(prediction$lwrCI)), col=add.alpha('mediumslateblue',0.3), border=NA)
points(prediction$year,prediction$fit,type="l",col="navyblue",lwd=3)
polygon(c(prediction2$year, rev(prediction2$year)), c(prediction2$uppCI, rev(prediction2$lwrCI)), col=add.alpha('lightblue4',0.3), border=NA)
points(prediction2$year,prediction2$fit,type="l",col="cadetblue4",lwd=3)
dev.off()
pop <- read.csv("rawdata/human/settlement.csv")
par(mar=c(4.1,4.1,2.1,6.1))
plot(pop$Date,pop$Population,
xlim=c(-1550,2000),
bty = 'n',xaxt='n',yaxt="n",ylab="",xlab="",
type="l",lwd=3,col="orange")
mtext("Iceland Human Population", side = 4, line = 3,col="orange")
axis(4,at=c(0,50000,100000,150000,200000,250000),las=2,cex.axis=0.6)
axis(4,at=c(0,50000,100000,150000,200000,250000),las=2,cex.axis=0.6)
axis(3,at=seq(-1500,2000,500),labels=paste0(sqrt(seq(-1500,2000,500)^2),c("BCE","BCE","BCE","","CE","CE","CE","CE")),lwd.ticks = 2,cex=2)
plot(pop$Date,pop$Population,
xlim=c(-1550,2000),
bty = 'n',xaxt='n',yaxt="n",ylab="",xlab="",
pch=16,lwd=3,col="orange")
mtext("Iceland Human Population", side = 4, line = 3,col="orange")
plot(pop$Date,pop$Population,
xlim=c(-1550,2000),
bty = 'n',xaxt='n',yaxt="n",ylab="",xlab="",
type="l",lwd=3,col="orange")
mtext("Iceland Human Population", side = 4, line = 3,col="orange")
axis(4,at=c(0,50000,100000,150000,200000,250000),las=2,cex.axis=0.6)
pdf("figures/composite/HumanPOP.pdf",height=2.5,width=10)
par(mar=c(4.1,4.1,2.1,6.1))
plot(pop$Date,pop$Population,
xlim=c(-1550,2000),
bty = 'n',xaxt='n',yaxt="n",ylab="",xlab="",
type="l",lwd=3,col="orange")
mtext("Iceland Human Population", side = 4, line = 3,col="orange")
axis(4,at=c(0,50000,100000,150000,200000,250000),las=2,cex.axis=0.6)
axis(3,at=seq(-1500,2000,500),labels=paste0(sqrt(seq(-1500,2000,500)^2),c("BCE","BCE","BCE","","CE","CE","CE","CE")),lwd.ticks = 2,cex=2)
dev.off()
library(ggOceanMapsData)
library(ggOceanMaps)
library(sf)
library(ggspatial)
pdf("Maps/OverviewV1mini.pdf",height = 2.5,width = 4.5)
basemap(limits = c(-25, -12, 63, 67), bathy.style = "rcb",rotate = TRUE,legends = FALSE)+
#basemap(limits = c(-25, -12, 63, 67),rotate = TRUE)+
ggspatial::geom_spatial_point(aes(x = Lon, y = Lat),data = metadata, color = c("black"),crs = 4326,cex=4.5)+
ggspatial::geom_spatial_point(aes(x = Lon, y = Lat),data = metadata, color = c("#52868B","#282E69"),crs = 4326,cex=4)+
ggspatial::geom_spatial_text(aes(x = Lon, y = Lat+0.3,label=CoreID),data = metadata,cex=3)+
xlab("")+
ylab("")
?annotation_scale
##
raw.metadata <- read.csv("metadata/CoreMetaData.csv")
metadata <- raw.metadata[raw.metadata$CoreID!="GC06"&raw.metadata$CoreID!="PC022",]
pdf("Maps/OverviewV1mini.pdf",height = 2.5,width = 4.5)
basemap(limits = c(-25, -12, 63, 67), bathy.style = "rcb",rotate = TRUE,legends = FALSE)+
#basemap(limits = c(-25, -12, 63, 67),rotate = TRUE)+
ggspatial::geom_spatial_point(aes(x = Lon, y = Lat),data = metadata, color = c("black"),crs = 4326,cex=4.5)+
ggspatial::geom_spatial_point(aes(x = Lon, y = Lat),data = metadata, color = c("#52868B","#282E69"),crs = 4326,cex=4)+
ggspatial::geom_spatial_text(aes(x = Lon, y = Lat+0.3,label=CoreID),data = metadata,cex=3)+
xlab("")+
ylab("")+
annotation_scale(location = "br")+
annotation_north_arrow(location = "tr", which_north = "true", height = unit(0.9, "cm"), width = unit(0.9, "cm"))
dev.off()
pdf("Maps/OverviewV1mini.pdf",height = 2.5,width = 4.5)
basemap(limits = c(-25, -12, 63, 67), bathy.style = "rcb",rotate = TRUE,legends = FALSE)+
#basemap(limits = c(-25, -12, 63, 67),rotate = TRUE)+
ggspatial::geom_spatial_point(aes(x = Lon, y = Lat),data = metadata, color = c("black"),crs = 4326,cex=4.5)+
ggspatial::geom_spatial_point(aes(x = Lon, y = Lat),data = metadata, color = c("#52868B","#282E69"),crs = 4326,cex=4)+
ggspatial::geom_spatial_text(aes(x = Lon, y = Lat+0.3,label=CoreID),data = metadata,cex=3)+
xlab("")+
ylab("")+
annotation_scale(location = "br")+
annotation_north_arrow(location = "tr", which_north = "true", height = unit(0.9, "cm"), width = unit(0.9, "cm"))
dev.off()
pdf("Maps/OverviewV1mini.pdf",height = 2.5,width = 4)
basemap(limits = c(-25, -12, 63, 67), bathy.style = "rcb",rotate = TRUE,legends = FALSE)+
#basemap(limits = c(-25, -12, 63, 67),rotate = TRUE)+
ggspatial::geom_spatial_point(aes(x = Lon, y = Lat),data = metadata, color = c("black"),crs = 4326,cex=4.5)+
ggspatial::geom_spatial_point(aes(x = Lon, y = Lat),data = metadata, color = c("#52868B","#282E69"),crs = 4326,cex=4)+
ggspatial::geom_spatial_text(aes(x = Lon, y = Lat+0.3,label=CoreID),data = metadata,cex=3)+
xlab("")+
ylab("")+
annotation_scale(location = "br")+
annotation_north_arrow(location = "tr", which_north = "true", height = unit(0.9, "cm"), width = unit(0.9, "cm"))
dev.off()
pdf("Maps/OverviewV1mini.pdf",height = 2.5,width = 3.5)
basemap(limits = c(-25, -12, 63, 67), bathy.style = "rcb",rotate = TRUE,legends = FALSE)+
#basemap(limits = c(-25, -12, 63, 67),rotate = TRUE)+
ggspatial::geom_spatial_point(aes(x = Lon, y = Lat),data = metadata, color = c("black"),crs = 4326,cex=4.5)+
ggspatial::geom_spatial_point(aes(x = Lon, y = Lat),data = metadata, color = c("#52868B","#282E69"),crs = 4326,cex=4)+
ggspatial::geom_spatial_text(aes(x = Lon, y = Lat+0.3,label=CoreID),data = metadata,cex=3)+
xlab("")+
ylab("")+
annotation_scale(location = "br")+
annotation_north_arrow(location = "tr", which_north = "true", height = unit(0.9, "cm"), width = unit(0.9, "cm"))
dev.off()
library("mgcv")
library("dplR")
library("zoo")
# some functions
add.alpha <- function(col, alpha=1){
if(missing(col))
stop("Please provide a vector of colours.")
apply(sapply(col, col2rgb)/255, 2,
function(x)
rgb(x[1], x[2], x[3], alpha=alpha))
}
### lets input data
climate <- read.csv("rawdata/climate/combined.csv")
sampledates <- read.csv("metadata/AgeOut.csv")
climatedat <- data.frame("Sample"=sampledates$ID,"Core"=sampledates$Core,"Date_bp_mean"=sampledates$mean,"Date_CE_mean"=1950-sampledates$mean)
unique(climate$record)
## Lets go!
## delta 13C
subset <- "Arcticad13C"
climate$record==subset
value <- climate$value[climate$record==subset]
year <- climate$year[climate$record==subset]
valueSpline <- detrend.series(value,nyrs = 100,return.info=TRUE)
plot(year,value,col="grey")
points(year,valueSpline$curves$Spline,type="l",col="yellow",lwd=3)
gam1 <- gam(value ~ s(year,k=50), method = "REML")
plot(gam1)
prediction <- data.frame("year"=953:2000)
prediction <- cbind(prediction,predict(gam1,newdata = prediction,se.fit = TRUE))
prediction$uppCI <- prediction$fit+prediction$se.fit*1.96
prediction$lwrCI <- prediction$fit-prediction$se.fit*1.96
prediction2 <- data.frame("year"=climatedat$Date_CE_mean)
prediction2$year[prediction2$year>max(year)|prediction2$year<min(year)] <- NA
prediction2 <- cbind(prediction2,predict(gam1,newdata = prediction2,se.fit = TRUE))
prediction2$uppCI <- prediction2$fit+prediction2$se.fit*1.96
prediction2$lwrCI <- prediction2$fit-prediction2$se.fit*1.96
prediction2$lowrezspline <- valueSpline$curves$Spline[match(prediction2$year,year)]
prediction$fit
points(year,prediction$fit,type="l")
par(mar=c(4.1,4.1,2.1,6.1))
plot(climate$year[climate$record==subset],climate$value[climate$record==subset],pch=16,
xlab="",
col=add.alpha('lightgreen',0.3),
xlim=c(-1550,2000),
ylim=c(3,1.5),
xaxt = 'n', bty = 'n',
yaxt ="n",ylab="")
axis(4,at=c(1.5,2,2.5,3))
mtext("Arctica d13C", side = 4, line = 3,col="green4")
points(year,valueSpline$curves$Spline,type="l",col="green4",lwd=3)
climate <- read.csv("rawdata/climate/combined.csv")
sampledates <- read.csv("metadata/AgeOut.csv")
climatedat <- data.frame("Sample"=sampledates$ID,"Core"=sampledates$Core,"Date_bp_mean"=sampledates$mean,"Date_CE_mean"=1950-sampledates$mean)
unique(climate$record)
## Lets go!
## delta 13C
subset <- "Arcticad13C"
climate$record==subset
value <- climate$value[climate$record==subset]
year <- climate$year[climate$record==subset]
valueSpline <- detrend.series(value,nyrs = 100,return.info=TRUE)
plot(year,value,col="grey")
points(year,valueSpline$curves$Spline,type="l",col="yellow",lwd=3)
gam1 <- gam(value ~ s(year,k=50), method = "REML")
plot(gam1)
prediction <- data.frame("year"=953:2000)
prediction <- cbind(prediction,predict(gam1,newdata = prediction,se.fit = TRUE))
prediction$uppCI <- prediction$fit+prediction$se.fit*1.96
prediction$lwrCI <- prediction$fit-prediction$se.fit*1.96
prediction2 <- data.frame("year"=climatedat$Date_CE_mean)
prediction2$year[prediction2$year>max(year)|prediction2$year<min(year)] <- NA
prediction2 <- cbind(prediction2,predict(gam1,newdata = prediction2,se.fit = TRUE))
prediction2$uppCI <- prediction2$fit+prediction2$se.fit*1.96
prediction2$lwrCI <- prediction2$fit-prediction2$se.fit*1.96
prediction2$lowrezspline <- valueSpline$curves$Spline[match(prediction2$year,year)]
prediction$fit
points(year,prediction$fit,type="l")
pdf("figures/climate/Artica_d13C.pdf",height=6,width =11)
plot(climate$year[climate$record==subset],climate$value[climate$record==subset],pch=16,
xlab="YearCE",
ylab="Arctica d13C",
col="grey30")
polygon(c(prediction$year, rev(prediction$year)), c(prediction$uppCI, rev(prediction$lwrCI)), col=add.alpha('darkgreen',0.3), border=NA)
points(prediction$year,prediction$fit,lwd=3,col="darkgreen",type='l')
points(year,valueSpline$curves$Spline,type="l",col="yellow",lwd=3)
dev.off()
colnames(prediction2) <- c("year","d13C.GAM.fit","d13C.GAM.fit.se","d13C.GAM.fit.uppCI","d13C.GAM.fit.lwrCI","d13C.100yrspline")
climatedat <- cbind(climatedat,prediction2)
pdf("figures/composite/d13C.pdf",height=4,width =10)
par(mar=c(4.1,4.1,2.1,6.1))
plot(climate$year[climate$record==subset],climate$value[climate$record==subset],pch=16,
xlab="",
col=add.alpha('lightgreen',0.3),
xlim=c(-1550,2000),
ylim=c(3,1.5),
xaxt = 'n', bty = 'n',
yaxt ="n",ylab="")
axis(4,at=c(1.5,2,2.5,3))
mtext("Arctica d13C", side = 4, line = 3,col="green4")
points(year,valueSpline$curves$Spline,type="l",col="green4",lwd=3)
dev.off()
## delta 18O
subset <- "Arcticad18O"
climate$record==subset
value <- climate$value[climate$record==subset]
year <- climate$year[climate$record==subset]
valueSpline <- detrend.series(value,nyrs = 100,return.info=TRUE)
plot(year,value,col="grey")
points(year,valueSpline$curves$Spline,type="l",col="yellow",lwd=3)
gam1 <- gam(value ~ s(year,k=50), method = "REML")
plot(gam1)
prediction <- data.frame("year"=953:2000)
prediction <- cbind(prediction,predict(gam1,newdata = prediction,se.fit = TRUE))
prediction$uppCI <- prediction$fit+prediction$se.fit*1.96
prediction$lwrCI <- prediction$fit-prediction$se.fit*1.96
prediction2 <- data.frame("year"=climatedat$Date_CE_mean)
prediction2$year[prediction2$year>max(year)|prediction2$year<min(year)] <- NA
prediction2 <- cbind(prediction2,predict(gam1,newdata = prediction2,se.fit = TRUE))
prediction2$uppCI <- prediction2$fit+prediction2$se.fit*1.96
prediction2$lwrCI <- prediction2$fit-prediction2$se.fit*1.96
prediction2$lowrezspline <- valueSpline$curves$Spline[match(prediction2$year,year)]
pdf("figures/climate/Artica_d18O.pdf",height=6,width =11)
plot(climate$year[climate$record==subset],climate$value[climate$record==subset],pch=16,
xlab="YearCE",
ylab="Arctica d18O",
col="grey30")
polygon(c(prediction$year, rev(prediction$year)), c(prediction$uppCI, rev(prediction$lwrCI)), col=add.alpha('darkgreen',0.3), border=NA)
points(prediction$year,prediction$fit,lwd=3,col="darkgreen",type='l')
points(year,valueSpline$curves$Spline,type="l",col="yellow",lwd=3)
dev.off()
colnames(prediction2) <- c("year","d18O.GAM.fit","d18O.GAM.fit.se","d18O.GAM.fit.uppCI","d18O.GAM.fit.lwrCI","d18O.100yrspline")
climatedat <- cbind(climatedat,prediction2)
pdf("figures/composite/d18O.pdf",height=4,width =10)
par(mar=c(4.1,4.1,2.1,6.1))
plot(climate$year[climate$record==subset],climate$value[climate$record==subset],pch=16,
xlab="",
col=add.alpha('green3',0.3),
xlim=c(-1550,2000),
ylim=c(4,3),
xaxt = 'n', bty = 'n',
yaxt ="n",ylab="")
axis(4,at=c(3,3.5,4))
mtext("Arctica d18O", side = 4, line = 3,col="green3")
points(year,valueSpline$curves$Spline,type="l",col="seagreen",lwd=3)
dev.off()
library("mgcv")
library("dplR")
library("zoo")
# some functions
add.alpha <- function(col, alpha=1){
if(missing(col))
stop("Please provide a vector of colours.")
apply(sapply(col, col2rgb)/255, 2,
function(x)
rgb(x[1], x[2], x[3], alpha=alpha))
}
### lets input data
climate <- read.csv("rawdata/climate/combined.csv")
sampledates <- read.csv("metadata/AgeOut.csv")
climatedat <- data.frame("Sample"=sampledates$ID,"Core"=sampledates$Core,"Date_bp_mean"=sampledates$mean,"Date_CE_mean"=1950-sampledates$mean)
unique(climate$record)
## Lets go!
## delta 13C
subset <- "Arcticad13C"
climate$record==subset
value <- climate$value[climate$record==subset]
year <- climate$year[climate$record==subset]
valueSpline <- detrend.series(value,nyrs = 100,return.info=TRUE)
plot(year,value,col="grey")
points(year,valueSpline$curves$Spline,type="l",col="yellow",lwd=3)
gam1 <- gam(value ~ s(year,k=50), method = "REML")
plot(gam1)
prediction <- data.frame("year"=953:2000)
prediction <- cbind(prediction,predict(gam1,newdata = prediction,se.fit = TRUE))
prediction$uppCI <- prediction$fit+prediction$se.fit*1.96
prediction$lwrCI <- prediction$fit-prediction$se.fit*1.96
prediction2 <- data.frame("year"=climatedat$Date_CE_mean)
prediction2$year[prediction2$year>max(year)|prediction2$year<min(year)] <- NA
prediction2 <- cbind(prediction2,predict(gam1,newdata = prediction2,se.fit = TRUE))
prediction2$uppCI <- prediction2$fit+prediction2$se.fit*1.96
prediction2$lwrCI <- prediction2$fit-prediction2$se.fit*1.96
prediction2$lowrezspline <- valueSpline$curves$Spline[match(prediction2$year,year)]
prediction$fit
points(year,prediction$fit,type="l")
pdf("figures/climate/Artica_d13C.pdf",height=6,width =11)
plot(climate$year[climate$record==subset],climate$value[climate$record==subset],pch=16,
xlab="YearCE",
ylab="Arctica d13C",
col="grey30")
polygon(c(prediction$year, rev(prediction$year)), c(prediction$uppCI, rev(prediction$lwrCI)), col=add.alpha('darkgreen',0.3), border=NA)
points(prediction$year,prediction$fit,lwd=3,col="darkgreen",type='l')
points(year,valueSpline$curves$Spline,type="l",col="yellow",lwd=3)
dev.off()
colnames(prediction2) <- c("year","d13C.GAM.fit","d13C.GAM.fit.se","d13C.GAM.fit.uppCI","d13C.GAM.fit.lwrCI","d13C.100yrspline")
climatedat <- cbind(climatedat,prediction2)
pdf("figures/composite/d13C.pdf",height=4,width =10)
par(mar=c(4.1,4.1,2.1,6.1))
plot(climate$year[climate$record==subset],climate$value[climate$record==subset],pch=16,
xlab="",
col=add.alpha('lightgreen',0.3),
xlim=c(-1550,2000),
xaxt = 'n', bty = 'n',
yaxt ="n",ylab="")
axis(4,at=c(1.5,2,2.5,3))
mtext("Arctica d13C", side = 4, line = 3,col="green4")
points(year,valueSpline$curves$Spline,type="l",col="green4",lwd=3)
dev.off()
## delta 18O
subset <- "Arcticad18O"
climate$record==subset
value <- climate$value[climate$record==subset]
year <- climate$year[climate$record==subset]
valueSpline <- detrend.series(value,nyrs = 100,return.info=TRUE)
plot(year,value,col="grey")
points(year,valueSpline$curves$Spline,type="l",col="yellow",lwd=3)
gam1 <- gam(value ~ s(year,k=50), method = "REML")
plot(gam1)
prediction <- data.frame("year"=953:2000)
prediction <- cbind(prediction,predict(gam1,newdata = prediction,se.fit = TRUE))
prediction$uppCI <- prediction$fit+prediction$se.fit*1.96
prediction$lwrCI <- prediction$fit-prediction$se.fit*1.96
prediction2 <- data.frame("year"=climatedat$Date_CE_mean)
prediction2$year[prediction2$year>max(year)|prediction2$year<min(year)] <- NA
prediction2 <- cbind(prediction2,predict(gam1,newdata = prediction2,se.fit = TRUE))
prediction2$uppCI <- prediction2$fit+prediction2$se.fit*1.96
prediction2$lwrCI <- prediction2$fit-prediction2$se.fit*1.96
prediction2$lowrezspline <- valueSpline$curves$Spline[match(prediction2$year,year)]
pdf("figures/climate/Artica_d18O.pdf",height=6,width =11)
plot(climate$year[climate$record==subset],climate$value[climate$record==subset],pch=16,
xlab="YearCE",
ylab="Arctica d18O",
col="grey30")
polygon(c(prediction$year, rev(prediction$year)), c(prediction$uppCI, rev(prediction$lwrCI)), col=add.alpha('darkgreen',0.3), border=NA)
points(prediction$year,prediction$fit,lwd=3,col="darkgreen",type='l')
points(year,valueSpline$curves$Spline,type="l",col="yellow",lwd=3)
dev.off()
colnames(prediction2) <- c("year","d18O.GAM.fit","d18O.GAM.fit.se","d18O.GAM.fit.uppCI","d18O.GAM.fit.lwrCI","d18O.100yrspline")
climatedat <- cbind(climatedat,prediction2)
pdf("figures/composite/d18O.pdf",height=4,width =10)
par(mar=c(4.1,4.1,2.1,6.1))
plot(climate$year[climate$record==subset],climate$value[climate$record==subset],pch=16,
xlab="",
col=add.alpha('green3',0.3),
xlim=c(-1550,2000),
xaxt = 'n', bty = 'n',
yaxt ="n",ylab="")
axis(4,at=c(3,3.5,4))
mtext("Arctica d18O", side = 4, line = 3,col="green3")
points(year,valueSpline$curves$Spline,type="l",col="seagreen",lwd=3)
dev.off()
climate <- read.csv("rawdata/climate/combined.csv")
sampledates <- read.csv("metadata/AgeOut.csv")
climatedat <- data.frame("Sample"=sampledates$ID,"Core"=sampledates$Core,"Date_bp_mean"=sampledates$mean,"Date_CE_mean"=1950-sampledates$mean)
unique(climate$record)
## Lets go!
## delta 13C
subset <- "Arcticad13C"
climate$record==subset
value <- climate$value[climate$record==subset]
year <- climate$year[climate$record==subset]
valueSpline <- detrend.series(value,nyrs = 100,return.info=TRUE)
plot(year,value,col="grey")
points(year,valueSpline$curves$Spline,type="l",col="yellow",lwd=3)
gam1 <- gam(value ~ s(year,k=50), method = "REML")
plot(gam1)
prediction <- data.frame("year"=953:2000)
prediction <- cbind(prediction,predict(gam1,newdata = prediction,se.fit = TRUE))
prediction$uppCI <- prediction$fit+prediction$se.fit*1.96
prediction$lwrCI <- prediction$fit-prediction$se.fit*1.96
prediction2 <- data.frame("year"=climatedat$Date_CE_mean)
prediction2$year[prediction2$year>max(year)|prediction2$year<min(year)] <- NA
prediction2 <- cbind(prediction2,predict(gam1,newdata = prediction2,se.fit = TRUE))
prediction2$uppCI <- prediction2$fit+prediction2$se.fit*1.96
prediction2$lwrCI <- prediction2$fit-prediction2$se.fit*1.96
prediction2$lowrezspline <- valueSpline$curves$Spline[match(prediction2$year,year)]
prediction$fit
points(year,prediction$fit,type="l")
pdf("figures/climate/Artica_d13C.pdf",height=6,width =11)
plot(climate$year[climate$record==subset],climate$value[climate$record==subset],pch=16,
xlab="YearCE",
ylab="Arctica d13C",
col="grey30")
polygon(c(prediction$year, rev(prediction$year)), c(prediction$uppCI, rev(prediction$lwrCI)), col=add.alpha('darkgreen',0.3), border=NA)
points(prediction$year,prediction$fit,lwd=3,col="darkgreen",type='l')
points(year,valueSpline$curves$Spline,type="l",col="yellow",lwd=3)
dev.off()
colnames(prediction2) <- c("year","d13C.GAM.fit","d13C.GAM.fit.se","d13C.GAM.fit.uppCI","d13C.GAM.fit.lwrCI","d13C.100yrspline")
climatedat <- cbind(climatedat,prediction2)
pdf("figures/composite/d13C.pdf",height=4,width =10)
par(mar=c(4.1,4.1,2.1,6.1))
plot(climate$year[climate$record==subset],climate$value[climate$record==subset],pch=16,
xlab="",
col=add.alpha('lightgreen',0.3),
xlim=c(-1550,2000),
ylim = rev(range(climate$value[climate$record==subset])),
xaxt = 'n', bty = 'n',
yaxt ="n",ylab="")
axis(4,at=c(1.5,2,2.5,3))
mtext("Arctica d13C", side = 4, line = 3,col="green4")
points(year,valueSpline$curves$Spline,type="l",col="green4",lwd=3)
dev.off()
## delta 18O
subset <- "Arcticad18O"
climate$record==subset
value <- climate$value[climate$record==subset]
year <- climate$year[climate$record==subset]
valueSpline <- detrend.series(value,nyrs = 100,return.info=TRUE)
plot(year,value,col="grey")
points(year,valueSpline$curves$Spline,type="l",col="yellow",lwd=3)
gam1 <- gam(value ~ s(year,k=50), method = "REML")
plot(gam1)
prediction <- data.frame("year"=953:2000)
prediction <- cbind(prediction,predict(gam1,newdata = prediction,se.fit = TRUE))
prediction$uppCI <- prediction$fit+prediction$se.fit*1.96
prediction$lwrCI <- prediction$fit-prediction$se.fit*1.96
prediction2 <- data.frame("year"=climatedat$Date_CE_mean)
prediction2$year[prediction2$year>max(year)|prediction2$year<min(year)] <- NA
prediction2 <- cbind(prediction2,predict(gam1,newdata = prediction2,se.fit = TRUE))
prediction2$uppCI <- prediction2$fit+prediction2$se.fit*1.96
prediction2$lwrCI <- prediction2$fit-prediction2$se.fit*1.96
prediction2$lowrezspline <- valueSpline$curves$Spline[match(prediction2$year,year)]
pdf("figures/climate/Artica_d18O.pdf",height=6,width =11)
plot(climate$year[climate$record==subset],climate$value[climate$record==subset],pch=16,
xlab="YearCE",
ylab="Arctica d18O",
col="grey30")
polygon(c(prediction$year, rev(prediction$year)), c(prediction$uppCI, rev(prediction$lwrCI)), col=add.alpha('darkgreen',0.3), border=NA)
points(prediction$year,prediction$fit,lwd=3,col="darkgreen",type='l')
points(year,valueSpline$curves$Spline,type="l",col="yellow",lwd=3)
dev.off()
colnames(prediction2) <- c("year","d18O.GAM.fit","d18O.GAM.fit.se","d18O.GAM.fit.uppCI","d18O.GAM.fit.lwrCI","d18O.100yrspline")
climatedat <- cbind(climatedat,prediction2)
pdf("figures/composite/d18O.pdf",height=4,width =10)
par(mar=c(4.1,4.1,2.1,6.1))
plot(climate$year[climate$record==subset],climate$value[climate$record==subset],pch=16,
xlab="",
col=add.alpha('green3',0.3),
xlim=c(-1550,2000),
ylim = rev(range(climate$value[climate$record==subset])),
xaxt = 'n', bty = 'n',
yaxt ="n",ylab="")
axis(4,at=c(3,3.5,4))
mtext("Arctica d18O", side = 4, line = 3,col="green3")
points(year,valueSpline$curves$Spline,type="l",col="seagreen",lwd=3)
dev.off()
